-- a) All records from one table

SELECT * FROM footballers;

-- b) A projection with 3 columns (reversed alphabetical order)

SELECT tm_name, tm_city, tm_goals FROM team ORDER BY tm_name DESC;

-- c) Restriction queries with multiple clauses demonstrating: teams with players from specific country, teams that begin with letters Ba, players that are not from Germany, born from MAR - NOV

SELECT ft_name, ft_surname, ft_country FROM footballers WHERE ft_country = 'SPAIN';

SELECT tm_name FROM team WHERE tm_name LIKE 'BA%';

SELECT ft_name, ft_surname, ft_country FROM footballers WHERE NOT ft_country = 'GERMANY';

SELECT ft_name, ft_surname, ft_dob FROM footballers WHERE TO_CHAR(ft_dob,'MM') BETWEEN '03' AND '11';

-- d) Join queries with data from: 2 tables, 3 tables, more tables

SELECT t.tm_name, s.st_name, s.st_review FROM stadium s, team t WHERE s.st_id = t.st_id;

SELECT f.ft_name, f.ft_surname, t.tm_name, s.st_name FROM stadium s JOIN team t ON s.st_id = t.st_id JOIN footballers f ON f.tm_id = t.tm_id;

SELECT f.ft_name, f.ft_surname, t.tm_name, sp.sp_name, sf.sp_fee FROM footballers f JOIN team t ON f.tm_id = t.tm_id JOIN sponsorship sf ON sf.tm_id = t.tm_id JOIN sponsor sp ON sp.sp_id = sf.sp_id;

-- e) Aggregate functions

-- 1. Show the footballers that their surname starts with K and ends with S.

SELECT ft_name, ft_surname FROM footballers WHERE ft_surname  LIKE 'K%S';

--2. Show the total number of players per team.

SELECT tm_name, COUNT(ft_id) FROM team t JOIN footballers f ON t.tm_id = f.tm_id GROUP BY t.tm_name;

-- 3. Which footballer is the highest-paid one?

SELECT ft_name, ft_surname, ft_contract FROM footballers WHERE ft_contract IN (SELECT MAX(ft_contract) FROM footballers);

-- 4. How many stadiums have a review score less than 2?

SELECT COUNT(st_id) FROM stadium WHERE st_review < 2;

-- 5. Show the footballers (surname and name and ID) in an ascending order and the team they are playing for.

SELECT ft_surname, ft_name, ft_id, tm_name FROM footballers f, team t WHERE f.tm_id = t.tm_id ORDER BY ft_surname,ft_name;

-- 6. Which footballer (surname, name and team) has scored the most goals?

SELECT ft_surname, ft_name, tm_name, ft_goals FROM footballers f JOIN team t ON f.tm_id = t.tm_id WHERE ft_goals = (SELECT MAX(ft_goals) FROM footballers);

-- 7. Show the total number of teams per city.

SELECT tm_city, COUNT(tm_city) "Teams per city" FROM team GROUP BY tm_city;

-- 8. Which team has the worst goal difference (goals scored – goals received)?

SELECT tm_name, (tm_goals - tm_concede) AS goal_diff FROM team WHERE (tm_goals - tm_concede) = (SELECT MIN(tm_goals - tm_concede) FROM team);

-- 9. How many stadiums were built between 1980 and 1999?

SELECT COUNT(st_id) "No stadiums built 1980-1990" FROM stadium WHERE st_year BETWEEN 1980 AND 1999;

-- 10. Show the footballers that were born in July (regardless of the year).

SELECT ft_name, ft_surname, ft_dob FROM footballers WHERE ft_dob LIKE '%JUL%';

-- 11. How many stadiums do not host a team in the database?

SELECT COUNT(st_id) FROM stadium  WHERE st_id NOT IN (SELECT st_id FROM team);

--12. Which team has the word “SAINT” in its title?

SELECT tm_name FROM team WHERE tm_name LIKE '%SAINT%';

-- 13. Which player from “BRAZIL” has the highest contract or scored the most goals?

SELECT ft_name, ft_surname, ft_contract, ft_goals, ft_country FROM footballers 
WHERE ft_country = 'BRAZIL' AND (ft_contract = (SELECT MAX(ft_contract) FROM footballers WHERE ft_country = 'BRAZIL') 
OR ft_goals = (SELECT MAX(ft_goals) FROM footballers WHERE ft_country = 'BRAZIL'));

-- 14. Show the player with the highest contract per position.

SELECT ft_name, ft_surname, ft_position, ft_contract FROM footballers
WHERE (ft_position, ft_contract) IN (SELECT ft_position, MAX(ft_contract) FROM footballers GROUP BY ft_position);

-- 15.Assume a username for the footballers is made up of the first 2 letters of their country of origin, added to the first 4 letters of their first name added to the first 4 letters of their surname. 
--    Write the query to create and show the username for each footballer. Do not attempt to input it in the ‘Players’ table.

SELECT ft_name, ft_surname, SUBSTR(ft_country,1,2)||SUBSTR(ft_name,1,4)||SUBSTR(ft_surname,1,4) "Username" FROM footballers;

-- 16. Show the total of the footballers’ contracts of the league (sum of all contracts of all players for all the teams).

SELECT SUM(ft_contract) AS total_contracts FROM footballers;

-- 17. Which sponsor spends the most money for advertising (sponsoring fees)?

SELECT sp_name, SUM(sp_fee) FROM sponsor s1, sponsorship s2 WHERE s1.sp_id = s2.sp_id GROUP BY sp_name HAVING SUM(sp_fee) = (SELECT MAX(SUM(sp_fee)) FROM sponsorship GROUP BY sp_id);

-- 18. Which type of business spends the most money for advertising (sponsoring fees)?

SELECT sp_type, SUM(sp_fee) FROM sponsor s1 JOIN sponsorship s2 ON s1.sp_id = s2.sp_id GROUP BY sp_type HAVING SUM(sp_fee) = (SELECT MAX(SUM(sp_fee)) FROM sponsorship s2 JOIN sponsor s1 ON s2.sp_id = s1.sp_id GROUP BY sp_type);

-- 19. Show the footballers with the highest average contracts per sponsor. Assume that footballers have the same sponsors as their team.

SELECT ft_name, ft_surname, sp_name, max_fee FROM (SELECT s1.sp_id, MAX(sp_fee) AS max_fee FROM sponsor s1 JOIN sponsorship s2 ON s1.sp_id = s2.sp_id GROUP BY s1.sp_id) s3 JOIN sponsor s1 ON s3.sp_id = s1.sp_id JOIN sponsorship s2 ON s1.sp_id = s2.sp_id AND s2.sp_fee = s3.max_fee JOIN team t ON s2.tm_id = t.tm_id JOIN footballers f ON t.tm_id = f.tm_id ORDER BY sp_name;

-- 20. Which team gets the most from the ‘ELECTRONICS’ sponsors?

SELECT tm_name, s3.sp_type, max_fee FROM (SELECT sp_type, MAX(sp_fee) AS max_fee FROM sponsor s1 JOIN sponsorship s2 ON s1.sp_id = s2.sp_id GROUP BY s1.sp_type) s1 JOIN sponsorship s2 ON s2.sp_fee = s1.max_fee JOIN team t ON s2.tm_id = t.tm_id JOIN sponsor s3 ON s3.sp_id = s2.sp_id  WHERE s3.sp_type = 'ELECTRONICS';
